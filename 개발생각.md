# 개발/설계중 나오는 팁이나 논쟁거리에 대해 이야기합니다.

# 도메인 interface 를 정의할때 엔티티를 직접 리턴하는 것은 문제가 없나?
- 아무 문제가 없다고 생각함. 의존관계나, 원칙, 성능이나 효용성 등 모든 면에서 문제가 없음
- 프레젠테이션 레이어에서 응답에 필요한 데이터를 꺼내서 잘 리턴하면 됨. (나중에 설명 예정)

# Spring Data Repository 와 Jpa Repository 와의 차이점은
- 스프링 데이터의 메소드를 만드는 관계가 있음
  - Entity save(Entity entity)
- 스프링 데이터는 어떤 데이터를 수정할때 호출한다는 관례를 따름
  - JPA는 새로운 엔티티 오브젝트를 생성, 영속화 아니면 준영속할때만 사용해서 좀 다름
  - 나중에 굉장히 중요한 역할을 할 것

# 코멘트(주석)
- 인터페이스의 메소드에도 코멘트가 필요할 때가 있음
  - 파라미터에 대한 설명
  - 실행하다가 발생할 수 있는 Exception
  - 예외적인 상황
## 클린코드에 위반되지 않는가?
- 전혀 아님. 
- 클린코드 저자가 코멘트에 대해 이야기할 코드를 엉망으로 만들고 그 잘못된 코드를 커버하기 위해 다는 코멘트(주석)을 쓰지 말라고 했음
- 따라서 인터페이스(포트)는 설명을 다하는 습관을 두는게 제일 중요함
  - 이를 API라고도 부름
  - API는 자신을 설명하는 문서를 작성하는것이 맞다.

# Password Encoder 에 대해서
- 회원 애플리케이션이 필요한 기능 중 패스워드 암소화가 있음
  - 도메인 안에 두기에는 너무 기술적이기 때문
  - 따라서 이를 required 인터페이스로 정의해야함
## 그러면 Domain의 Member에서 사용하는 PasswordEncoder 인터페이스를 Application 레이어에 옮겨야 하는가?
- 안됨.
- 도메인에서 애플리케이션 레이어를 의존하는 형태가 되어버리기 때문..
- 도메인 모델을 표현하는 도메인 서비스를 인터페이스만 만들고 
  - 그 도메인 서비스 로직을 둘수 없을 때는 
  - 결국 도메인 레이어에서 필요한 기능이기 때문에 
  - 해당 인터페이스를 도메인에 두는 것이 맞음.


# Entity
- 어떤 대상을 엔티티라고 부르려면 식별자를 가져야하는 것이 기본 조건
  - Member의 경우 email이 식별자가 됨. 이게 최선일까?
## 엔티티 식별자가 되기 위한 기준
- 고유성 (두 개의 엔티티가 같은 값을 가지면 안 됨)
- 불변성 (한번 값이 할당되면 엔티티의 생명주기 동안 절대 변경되면 안 된다.)
  - 이를 참조 정합성이 훼손되고, 연관관계를 깨뜨린다.
- 비즈니스적인 의미로부터 디커플링 되는 것이 좋다.
> 따라서 이메일은 불변성을 깨뜨릴 수 있고, 비즈니스적인 의미가 강하기 때문에 식별자로 적합하지 않음
- 따라서 자연 키 대신 인조키(대리 키) 사용

## 도메인의 엔티티에 Jpa 관련 어노테이션을 붙이는 것
- 어노테이션은 그냥 주석일 뿐 의존성에 영향을 끼치지 않음
- 특정 기술에 종속적인 코드가 되지 않는다는 것.
- JPA를 안 쓰고 다른 기술을 쓴다고 해서 이 어노테이션이 문제가 되지 않음.
- 컴파일할때는 JPA 인터페이스가 필요하겠지만,, 런타임에서는 전혀 문제가 안 됨


# DataJpaTest
- Spring의 모든 빈을 다 띄우는게 아니라 Data Jpa가 동작할 수 있는 최소한의 빈들로만 구성해서 띄워줌
- 데이터베이스 연결을 기본적으로 h2 embedded DB를 사용해 메모리안에서 돌아가기때문에 DB를 따로 셋업 안해도 되고 굉장히 빠름
- jpa 표준을 따라 portable하게 만들어진 repository라면 이거 사용하면 됨.